<div class="container-fluid pt-5">
  <div class="ui-g">
    <div class="ui-g-12 pt-3">
      <h5 class="d-flex mt-5 mb-4">Formulário Central de Análises</h5>
      <button
        class="btn btn-primary mb-2"
        (click)="showDialogFormulario(null)"
      >
        Criar Formulário
      </button>
    </div>

    <!-- TABELA DE FORMULÁRIOS -->
    <div class="ui-g-12">
      <p-table [value]="formularios">
        <ng-template pTemplate="header">
          <tr>
            <th>Usuário</th>
            <th>Modelo</th>
            <th>Natureza Operação</th>
            <th>Ensaios</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Opções</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-formulario>
          <tr>
            <td>{{ formulario.usuario.nome }}</td>
            <td>{{ formulario.modelo.nome }}</td>
            <td>{{ formulario.naturezaOperacao }}</td>
            <td>{{ formulario.quantidadeEnsaios }}</td>
            <td>{{ formulario.valorTotal }}</td>
            <td>{{ getFormStatusText(formulario.status) }}</td>
            <td class="text-center">
              <p-button
                class="mx-1"
                icon="pi pi-list"
                pTooltip="Editar formulário"
                (click)="showDialogFormulario(formulario)"
              ></p-button>

              <p-button
                class="mx-1"
                icon="pi pi-user"
                pTooltip="Validar usuário"
              ></p-button>

              <p-button
                class="mx-1"
                icon="pi pi-tag"
                pTooltip="Vincular amostra"
              ></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<!-- DIALOG FORMULÁRIO -->
<p-dialog
  modal="modal"
  [width]="900"
  header="Formulário"
  [responsive]="true"
  [(visible)]="dialogFormulario"
  [style]="{'min-height': '600px'}"
>
  <div class="col-sm-12">
    <div class="form-group" *ngIf="isAdmin()">
      <label>Status</label><br>
      <p-dropdown
        optionLabel="text"
        [options]="formStatusItems"
        [style]="{'width': '100%'}"
        [(ngModel)]="formStatus"
      ></p-dropdown>
    </div>

    <div class="form-group">
      <label>Usuário</label><br>
      <p-dropdown
        optionLabel="nome"
        [options]="usuarios"
        [style]="{'width': '100%'}"
        [(ngModel)]="formularioEdit.usuario"
      ></p-dropdown>
    </div>

    <div class="form-group">
      <label>Nome</label>
      <input
        readonly
        class="form-control"
        [(ngModel)]="formularioEdit.usuario.nome"
      >
    </div>

    <div class="form-group">
      <label>Email</label>
      <input
        readonly
        class="form-control"
        [(ngModel)]="formularioEdit.usuario.email"
      >
    </div>

    <div class="form-group">
      <label>Tipo Pessoa</label>
      <input
        readonly
        class="form-control"
        [(ngModel)]="formularioEdit.usuario.tipoPessoa"
      >
    </div>

    <div
      class="form-group"
      *ngIf="formularioEdit.usuario.instituicao && formularioEdit.usuario.instituicao.id"
    >
      <label>Instituição</label>
      <input
        readonly
        class="form-control"
        [(ngModel)]="formularioEdit.usuario.instituicao.nomeFantasia"
      >
    </div>

    <div class="form-group" *ngIf="formularioEdit.usuario.departamento">
      <label>Departamento</label>
      <input
        readonly
        class="form-control"
        [(ngModel)]="formularioEdit.usuario.departamento"
      >
    </div>

    <div class="form-group" *ngIf="formularioEdit.usuario.orientador">
      <label>Orientador</label>
      <input
        readonly
        class="form-control"
        [(ngModel)]="formularioEdit.usuario.orientador"
      >
    </div>

    <div class="form-group">
      <label>Natureza do Projeto</label><br>
      <p-dropdown
        optionLabel="text"
        [options]="naturezaProjetoItems"
        [style]="{'width': '100%'}"
        [(ngModel)]="naturezaProjeto"
      ></p-dropdown>
    </div>

    <div class="form-group" *ngIf="naturezaProjeto.value === 'Outro'">
      <label>Descrição da Natureza do Projeto</label>
      <input
        class="form-control"
        [(ngModel)]="formularioEdit.naturezaOperacao"
      >
    </div>

    <div class="form-group">
      <label>Equipamento</label><br>
      <p-dropdown
        optionLabel="nome"
        [options]="equipamentos"
        [style]="{'width': '100%'}"
        [(ngModel)]="selectedEquipamento"
        (onChange)="setFormModelo()"
        class="mb-3"
      ></p-dropdown>
      <ckeditor
        [editor]="editor"
        [(ngModel)]="formularioEdit.modelo.metodologia"
        class="w-100"
        id="metodologia-editor"
        name="metodologia-editor">
      </ckeditor>
    </div>

    <div class="row mt-3 mb-3 ">
      <button type="button" class="btn btn-danger ml-2" (click)="closeDialogFormulario()">Cancelar</button>
      <button type="button" class="btn btn-success ml-2" (click)="saveFormulario()">Salvar</button>
    </div>
  </div>
</p-dialog>
